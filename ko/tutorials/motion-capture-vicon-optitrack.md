# 모션 캡처 비행(VICON, Optitrack)

:::warning
**작성중입니다**.

이 주제는 [외부 위치 추정(ROS)](../ros/external_position_estimation.md)과 다소 중복됩니다.
:::

VICON이나 Optitrack과 같은 실내 모션 캡처 시스템을 사용하여, 차량 상태 추정을 위한 위치 및 자세 데이터를 제공하거나, 분석을 위한 실측 자료로 사용할 수 있습니다. 모션 캡처 데이터는 로컬 원점을 기준으로 PX4의 로컬 위치 추정치를 업데이트할 수 있습니다. 모션 캡처 시스템의 방향(요)은 자세 추정기에 의해 선택적으로 통합될 수 있습니다.

모션 캡처 시스템의 포즈(위치 및 방향) 데이터는 [ATT_POS_MOCAP](https://mavlink.io/en/messages/common.html#ATT_POS_MOCAP) 메시지를 사용하여 MAVLink로 자동조종장치에 전송됩니다. 데이터 표현 규칙에 대한 좌표 프레임은 아래 섹션을 참고하십시오. [mavros](../ros/mavros_installation.md) ROS-Mavlink 인터페이스에는 이 메시지 전송을 위한 기본 플러그인이 있습니다. C/C++ 코드와 MAVLink 라이브러리를 사용하여 전송할 수도 있습니다.

## 컴퓨팅 아키텍처

안정적인 통신을 위하여 **온보드** 컴퓨터(예: Raspberry Pi, ODroid 등)에서 모션 캡처 데이터를 전송하는 방식이 **매우 권장됩니다**. 온보드 컴퓨터는 안정적인 고대역폭의 WiFi로 모션 캡처 컴퓨터에 연결할 수 있습니다.

3DR/SiK 라디오와 같은 표준 텔레메트리 통신은 고대역폭 모션 캡처 애플리케이션에는 **적합하지 않습니다**.

## 좌표 프레임

시스템에서 적절한 기준 좌표계를  설정하는 방법을 설명합니다. 다양한 표현법이 있지만 ENU와 NED 방식을 사용합니다.

* ENU는 지상 고정 좌표로서,  **X**축은 동쪽, **Y** 축은 북쪽, **Z**축은 상공을 향합니다. 로봇/기체 틀 기준으로는 **X**축은 전면, **Z**축은 상단, **Y**축은 좌측을 향합니다.
* NED에서 **X**축은 북쪽, **Y**축은 동쪽, **Z**축은 지면을 향합니다. 로봇/기체 틀 기준으로는 **X**축은 북쪽, **Y**축은 동쪽 **Z**축은 지면을 향합니다.

프레임은 아래 이미지에 표시됩니다. NED는 좌측, ENU는 우측에 있습니다: ![참조 프레임](../../assets/lpe/ref_frames.png)

그러나 외부 방향 추정시, 자북은 무시하고 가상 세계 *X* 좌표 축을 따라 벡터 기준을 삼습니다(움직임 촬영 기법으로 보정할 때 언제든 자유롭게 둘 수 있습니다), 방위각면이 로컬 *x* 좌표를 두는 면입니다.

:::warning
움직임을 감지하는 프로그램에서 강체를 만들 때, 세계 **X** 좌표 축에 로봇을 우선 맞춰야 함을 기억하십시오. 그렇지 않으면 방위 회전각 추정시 초기 오프셋으로 처리합니다.
:::

## 추정기 선택

### LPE와 고도 추정기 Q

### EKF2


모션 캡쳐에 대한 ROS 주제는 mocap 시스템의 경우 `mocap_pose_estimate`이고, 비전의 경우 `vision_pose_estimate`입니다. 자세한 정보는 [mavros_extras](http://wiki.ros.org/mavros_extras)를 참고하십시오.


## 테스트

## 문제 해결
