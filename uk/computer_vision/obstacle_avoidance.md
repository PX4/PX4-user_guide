# Уникнення перешкод (Мультикоптер)

Уникання перешкод _Obstacle Avoidance_ дозволяє транспортному засобу уникнути перешкод під час слідування передзапланованим шляхом.

Ця функція передбачає наявність компаньйонного комп'ютера, на якому працює програмне забезпечення комп'ютерного зору. Це програмне забезпечення забезпечує маршрут для заданої бажаної траєкторії, картографує та орієнтується навколо перешкод для досягнення найкращого шляху.

Уникання перешкод призначене для автоматичних режимів і в даний момент підтримується для багатокоптерних транспортних засобів у режимах Місії [Missions](#mission_mode) та [Offboard mode](#offboard_mode).

У цій темі пояснюється, як налаштувати та активувати цю функцію в обох режимах.

## Обмеження/Можливості

- Максимальна швидкість для уникання перешкод наразі становить приблизно 3 м/с (через витрати обчислення шляху уникнення).

  ::: info Уникнення перешкод може використовувати _локальний планувальник_ (видає повідомлення приблизно з частотою ~30Гц і може рухатися зі швидкістю близько 3 м/с) або _глобальний планувальник_ (видає повідомлення приблизно з частотою ~10Гц і швидкість місії з уникненням перешкод становить близько 1-1,5 м/с).
:::

<a id="offboard_mode"></a>

## Уникнення у режимі Оффборд

PX4 підтримує уникнення перешкод у режимі [Оффборд](../flight_modes/offboard.md).

Бажаний маршрут надходить від вузла [ROS](../ros/index.md), який працює на компаньйонному комп'ютері. Це передається до модуля уникнення перешкод (іншого вузла ROS). Програмне забезпечення для уникнення надсилає запланований шлях до стека польотів як потік повідомлень `SET_POSITION_TARGET_LOCAL_NED`.

Єдине необхідне налаштування PX4 - перевести PX4 у режим Оффборд _Offboard mode_.

На компаньйонному комп'ютері надається налаштування обладнання та конфігурація обладнання/програмного забезпечення у репозиторії [PX4/PX4-Avoidance Github](https://github.com/PX4/PX4-Avoidance).

<a id="mission_mode"></a>

## Уникнення в режимі Місії

PX4 підтримує уникнення перешкод у режимі Місії [Mission mode](../flight_modes_mc/mission.md), використовуючи програмне забезпечення уникнення, яке працює на окремому компаньйонному комп'ютері.

### Прогрес Місії

Поведінка місії з активованим уникненням перешкод _відрізняється трохи_ від оригінального плану.

Відмінності при активному уникненні полягають у наступному:

- Точка місії вважається "досягнутою", коли транспортний засіб перебуває у межах радіуса прийняття, незалежно від свого напрямку.
  - Це відрізняється від звичайних місій, у яких транспортний засіб повинен досягти точки місії з певним напрямком (тобто в "близькому до" прямому напрямку від попередньої точки місії). Ця умова не може бути виконана, коли активоване уникнення перешкод, оскільки алгоритм уникнення перешкод має повний контроль над напрямком транспортного засобу, і транспортний засіб завжди рухається в поточному полі зору.
- PX4 починає видачу нової поточної/наступної точки місії, як тільки попередня точка місії досягнута (тобто в той момент, коли транспортний засіб входить у радіус прийняття).
- Якщо точка місії перебуває _всередині_ перешкоди, вона може бути недосяжною (і місія буде заблокована).
  - Якщо проекція транспортного засобу на лінію попередньої-поточної точки місії проходить поточну точку місії, радіус прийняття збільшується таким чином, що поточна точка місії вважається досягнутою
  - Якщо транспортний засіб знаходиться в межах радіуса прийняття по x-і y-осі, прийняття по висоті модифікується таким чином, щоб місія продовжувалася (навіть якщо вона не знаходиться в радіусі прийняття по висоті).
- Оригінальна швидкість місії (як встановлено в _QGroundControl_/PX4) ігнорується. Швидкість буде визначатися програмним забезпеченням уникнення:
  - швидкість місії для _локального планера_ становить приблизно 3 м/с.
  - _швидкість місії_ для глобального планера становить приблизно 1-1,5 м/с.

Якщо PX4 перестане отримувати оновлення заданих значень більше ніж на півсекунди, він перейде в [режим утримання](../flight_modes_mc/hold.md).

### Налаштування PX4

Уникнення перешкод активується в PX4 шляхом [встановлення](../advanced_config/parameters.md) значення [COM_OBS_AVOID](../advanced_config/parameter_reference.md#COM_OBS_AVOID) на 1.

::: info `COM_OBS_AVOID` також активує [Безпечне Посадку](../computer_vision/safe_landing.md) та будь-які інші функції, що використовують [Інтерфейс Відсутності Планування Шляху](../computer_vision/path_planning_interface.md) PX4 Offboard (Інтерфейс Траєкторії), щоб інтегрувати зовнішні служби планування шляху з PX4.
:::

## Налаштування Компаньйонного Комп'ютера

Налаштування апаратної частини на стороні компаньйонного комп'ютера та конфігурація апаратної та програмної частин надається у репозиторії [PX4/PX4-Avoidance](https://github.com/PX4/PX4-Avoidance) на Github.

Уникнення перешкод у місіях може використовувати як _локальний_, так і _глобальний планер_ (локальний планер рекомендований/має кращу продуктивність).

<a id="interface"></a>

## Інтерфейс Уникнення Перешкод

PX4 використовує [Інтерфейс Відсутності Планування Шляху](../computer_vision/path_planning_interface.md) для інтеграції служб планування шляху з компаньйонним комп'ютером (включаючи [Уникнення Перешкод у місіях](../computer_vision/obstacle_avoidance.md#mission_mode), [Безпечну Посадку](../computer_vision/safe_landing.md) та майбутні сервіси).

Інтерфейс (відправлені повідомлення) між PX4 та компаньйоном точно _такий самий_, як і для будь-яких інших служб планування шляху.

## Підтримуване Обладнання

Перевірені компаньйонні комп'ютери та камери перераховані в [PX4/PX4-Avoidance](https://github.com/PX4/PX4-Avoidance#run-on-hardware).
