# Польоти з використанням систем захоплення руху (VICON, NOKOV, Optitrack)

::: попередження **РОБОТА В ПРОЦЕСІ**

Ця тема значно збігається з [Оцінкою зовнішньої позиції (ROS)](../ros/external_position_estimation.md).
:::

Системи захоплення руху у приміщенні, такі як VICON, NOKOV та Optitrack, можуть бути використані для надання даних про положення та орієнтацію для оцінки стану транспортного засобу або можуть бути використані як основа для аналізу. Дані з систем захоплення руху можуть бути використані для оновлення локальної оцінки положення PX4 відносно локального початку координат Курс (поворот) з системи захоплення руху також може бути опціонально інтегрований оцінювачем положення.

Дані про положення (позицію та орієнтацію) з системи захоплення руху надсилаються автопілоту через MAVLink, використовуючи повідомлення [ATT_POS_MOCAP](https://mavlink.io/en/messages/common.html#ATT_POS_MOCAP). Дивіться розділ нижче про системи координат для норм представлення даних. ROS-Mavlink інтерфейс [mavros](../ros/mavros_installation.md) має стандартний плагін для надсилання цього повідомлення. Їх також можна надсилати, використовуючи чистий код на мовах програмування C/C++ та бібліотеки MAVLink.

## Архітектура обчислювальних систем

**Дуже рекомендується** надсилати дані захоплення руху через **бортовий** комп'ютер (наприклад, Raspberry Pi, ODroid і т. д.) для надійного зв'язку. Вбудований комп'ютер може бути підключений до комп'ютера руху за допомогою WiFi, що забезпечує надійне, високопропускне з'єднання.

Більшість стандартних телеметричних зв'язків, таких як радіоприймачі 3DR/SiK, **не підходять** для застосувань з високою пропускною здатністю, пов'язаних з захопленням руху.

## Системи координат

У цьому розділі показано, як налаштувати систему з відповідними опорними системами. Існує різноманітні представлення, але ми використовуватимемо два з них: ENU і NED.

- ENU - це земельно-фіксована система, де вісь **X** вказує на схід, **Y** - на північ, а **Z** - вгору. Корпус робота/транспортного засобу відповідно до цього має вісь **X** наперед, **Z** вгору і **Y** ліворуч.
- NED має вісь **X **направлену на північ, **Y** - на схід і **Z** - вниз. Корпус робота/транспортного засобу має вісь **X** наперед, **Z** вниз і **Y** відповідно.

На зображенні нижче показані системи координат. NED ліворуч, ENU праворуч:

![Reference frames](../../assets/lpe/ref_frames.png)

Зовнішній оціночний заголовок, однак, ігнорує магнітний північ і підробляється вектором, що відповідає світовій вісі _X_ (який може бути розміщений вільно під час калібрування mocap); кут розвороту буде визначено щодо місцевої вісі _X_.

:::warning
При створенні жорсткого тіла в програмному забезпеченні захоплення руху спочатку вирівнюйте робота зі світовою віссю **X**, інакше оцінка розвороту матиме початкове зміщення.
:::

## Оціночники стану

EKF2 рекомендується для систем з GPS (LPE застаріла, тому її більше не підтримується або не підтримується). Q-Estimator рекомендується, якщо у вас немає GPS, оскільки він працює без магнітометра або барометра.

Див. [Перемикання оціночників стану](../advanced/switching_state_estimators.md) для отримання додаткової інформації.

### EKF2

ROS-тема для motion cap `mocap_pose_estimate` для систем mocap та `vision_pose_estimate` для бачення. Перевірте [mavros_extras](http://wiki.ros.org/mavros_extras) для отримання додаткової інформації.

## Тестування

## Вирішення проблем
