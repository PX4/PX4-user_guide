# Конфігурація мультикоптера

Конфігурація та калібрування багтороторного вертольота виконується за тими ж високорівневими кроками, що і інші рами: вибір прошивки, конфігурація рами, включаючи геометрію приводника/двигуна та відображення виводів, конфігурація та калібрування сенсорів, налаштування безпеки та інших функцій, а також налаштування.

Ця тема пояснює, як налаштувати багатокоптер, використовуючи вибрані теми з [Стандартна конфігурація](../config/index.md), [Розширена конфігурація](../advanced_config/index.md) та [Периферійні пристрої контролера польоту](../peripherals/index.md), разом з темами настройки, специфічними для багатокоптерів.

::: info
Ця тема є рекомендованою точкою запису при першому виконанні конфігурації і калібрування нового кадру мультиоптика.
:::

## Завантаження прошивки

Перший крок - [завантажити прошивку PX4](../config/firmware.md) на ваш [контролер польоту](../flight_controller/index.md). Це найлегше зробити за допомогою QGroundControl, який автоматично вибере відповідне прошивку для вашого конкретного обладнання контролера. За замовчуванням QGC встановить останню стабільну версію PX4, але ви можете вибрати бета-версію або власні версії, якщо потрібно.

Відповідні теми:

- [Завантаження прошивки](../config/firmware.md)

## Вибір та налаштування каркасу

Цей розділ пояснює, як налаштувати тип транспортного засобу (багатокоптер), конкретну геометрію двигуна/керування польотом та виходи двигуна.

Спочатку [виберіть каркас багтроторного вертольота](../config/airframe.md) (варіанти перераховані в [Довідник з каркасів >  Вертольот](../airframes/airframe_reference.md#copter)). Ви повинні вибрати рамку, яка відповідає марці та моделі вашого транспортного засобу, якщо така існує, а в іншому випадку виберіть тип рамки "Загальний", який найбільш точно відповідає вашій геометрії за кількістю двигунів та їх відносними положеннями. Наприклад, для рами [Quadrotor X](../airframes/airframe_reference.md#quadrotor-x) ви шукаєте назву вашої рами у списку, і якщо вона відсутня, виберіть раму [Загальний Quadrotor X](../airframes/airframe_reference.md#copter_quadrotor_x_generic_quadcopter).

:::info Будь-яка обрана рама багтороторного коптера може бути змінена на наступному кроці (конфігурація приводу), щоб додати / видалити двигуни та змінити геометрію, і вказати, які виходи польотного контролера підключені до певних двигунів та властивості виходу. Вибір рамки, яка відповідає вашому транспортному засобу, зменшує роботу з налаштуванням, необхідну для виконання.

:::details
Як це працює (деталі) Вибір підфрейму застосовує [файл конфігурації фрейму](../dev_airframes/adding_a_new_frame.md#adding-a-frame-configuration), який містить попередньо визначений набір [параметрів](../advanced_config/parameters.md), таких як [CA_AIRFRAME=0](../advanced_config/parameter_reference.md#CA_AIRFRAME) для типу транспортного засобу та [CA_ROTOR_COUNT](../advanced_config/parameter_reference.md#CA_ROTOR_COUNT) для кількості роторів.

Конфігурація рами може визначити все про транспортний засіб, від його геометрії та відображень виходу до налаштувань та калібрування значень. Коли ви виводите новий транспортний засіб, рама зазвичай містить досить мінімальну конфігурацію:

- Кадри з назвою "Загальний" визначають тип транспортного засобу, кількість роторів та позиції роторів-заповнювачі. Після вибору конструкції фюзеляжу ви визначаєте фактичну геометрію, а потім налаштовуєте виходи.
- Кадри з назвою моделі/бренду визначать тип транспортного засобу, кількість роторів, фактичні позиції роторів та напрямки руху двигуна. Після вибору конструкції фюзеляжу вам зазвичай все ще потрібно налаштувати виводи.
:::

Наступним кроком є визначення геометрії вашого транспортного засобу [(кількість двигунів та їх відносні позиції)](../config/actuators.md#motor-geometry-multicopter) та [призначення цих двигунів](../config/actuators.md#actuator-outputs) фізичним виходам, до яких вони підключені на вашому польотному контролері (обидва ці аспекти розглянуті в [Конфігурації та Тестуванні Актуаторів](../config/actuators.md)).

Якщо використовуєте PWM ESC та OneShot ESC (але не DShot та DroneCAN/Cyphal ESC), то потім слід виконати [Калібрування ESC](../advanced_config/esc_calibration.md) перед переходом до [Конфігурації двигуна](../config/actuators.md#motor-configuration). Це забезпечує, що всі ESC надають точно такий самий вихід для заданого входу (ідеально, ми спочатку калібруємо ESC, але ви не можете калібрувати свої ESC, поки ви не відобразите виходи).

Останнім кроком є [Конфігурація двигуна](../config/actuators.md#motor-configuration):

- [Реверс будь-яких моторів](../config/actuators.md#reversing-motors), які не відповідають напрямку обертання, налаштованому в геометрії. Для DShot ESC ви можете це зробити через інтерфейс тестування приводу.
- PWM, OneShot та CAN ESC встановлюють ліміти введення мотора для режимів роззброєння, низької та високої швидкості (не потрібно для DShot ESC)

Відповідні теми:

- [Вибір транспортного засобу (рами)](../config/airframe.md) — Виберіть тип транспортного засобу, щоб відповідати вашій рамі.
- [Налаштування та тестування приводів](../config/actuators.md) — Геометрія транспортного засобу, виведення відображення, конфігурація двигуна, тестування.
- [Калібрування ESC](../advanced_config/esc_calibration.md) — Виконайте між картировкой виводів та конфігурацією двигуна (тема вище) для ESC з PWM та OneShot.

## Налаштування та калібрування датчика

PX4 найчастіше покладається на магнітометр (компас) для отримання інформації про напрямок, барометр для висоти, гіроскоп для швидкостей тіла, акселерометр для ставлення та GPS/GNSS для глобального положення. Польотні контролери Pixhawk (і багато інших) мають вбудований магнітометр, акселерометр, гіроскоп та барометр. Вбудований компас зазвичай не є особливо надійним, і часто додається зовнішній компас (зазвичай поєднаний з приймачем ГНСС в одному пристрої).

Спочатку нам потрібно встановити [Орієнтацію сенсора](../config/flight_controller_orientation.md), повідомляючи PX4, як автопілот (і його вбудовані сенсори) та зовнішні компаси орієнтовані відносно транспортного засобу. Загалом ви будете орієнтуватися на передню частину транспортного засобу і не матимете встановлювати нічого. Після того, як це зроблено, нам потрібно калібрувати компас(и), гіроскоп та акселерометр.

Основний датчик налаштування вкритий у цих темах:

- [Орієнтація сенсорів](../config/flight_controller_orientation.md)
- [Компас](../config/compass.md)
- [Гіроскоп](../config/gyroscope.md)
- [Акселерометр](../config/accelerometer.md)

PX4 може використовувати інші периферійні пристрої, такі як датчики відстані, оптичні датчики руху, сигнали уникання трафіку, камери тощо:

- [Периферія контролера польоту](../peripherals/index.md) - налаштування конкретних датчиків, опціональних датчиків, актуаторів тощо.

:::info Датчики, які вам не потрібно калібрувати/налаштовувати, включають:

- Калібрування [рівня горизонту](../config/level_horizon_calibration.md) зазвичай не потрібне, якщо ви встановили рівень керування польотом.
- Датчики, яких немає або які не використовуються PX4 багтороторником для керування польотом, такі як [Датчики швидкості повітря](../config/airspeed.md).
- Датчики, які не потребують калібрування, включаючи: Барометри та GNSS.

:::

## Налаштування керування вручному режимі

Пілоти можуть керувати транспортним засобом вручну за допомогою системи радіоуправління (RC) або контролера джойстика/геймпада, підключеного через QGroundControl.

:::info
Ручне керування є важливим для безпечного запуску нового транспортного засобу!
:::

Радіоуправління:

- [Налаштування керування радіо (RC)](../config/radio.md)
- [Конфігурація режиму польоту](../config/flight_mode.md)

Джойстик/Ґеймпад:

- [Налаштування джойстика](../config/joystick.md) (включає відображення кнопок/режиму польоту)

## Конфігурація безпеки

PX4 може бути налаштований для автоматичної обробки умов, таких як низький заряд акумулятора, втрата радіо- або даних, польот занадто далеко від дому та інше:

- [Налаштування оцінки батареї](../config/battery.md) — оцінка залишкової потужності (необхідна для аварійного режиму з низькою потужністю).
- [Конфігурація безпеки (запобіжники)](../config/safety.md)

## Тюнінг

Налаштування - це останній крок, який виконується лише після завершення більшості інших налаштувань та конфігурації.

- Контролери швидкості та нахилу:
- [Автоналаштування](../config/autotune.md) — Автоматизує налаштування керування швидкістю та позицією PX4 (рекомендовано).

  :::info
Автоматична настройка працює на кадрах, які мають розумну авторитетність та динаміку навколо всіх трьох осей тіла.
Це було перевірено в основному на гоночних квадрокоптерах та X500, і очікується, що воно буде менш ефективним на трикоптерах з нахилом ротора.
Інші два керівництва потрібні лише у випадку проблеми з автоналадкою.
:::

- [Налаштування PID для МК (Посібник/Основи)](../config_mc/pid_tuning_guide_multicopter_basic.md) — Основи ручного налаштування.
- [Посібник з налаштування PID для МК (Посібник/Детальний)](../config_mc/pid_tuning_guide_multicopter.md) — Ручне налаштування з докладним поясненням.
- [Налаштування затримки фільтра/керування MC](../config_mc/filter_tuning.md) — Узгодження затримки керування та фільтрації шумів.
- [MC Налаштування заданого пункту (Генератор Траєкторії)](../config_mc/mc_trajectory_tuning.md)
  - [MC Jerk-обмежений тип траєкторії](../config_mc/mc_jerk_limited_type_trajectory.md)
- [Налаштування гоночного мультикоптера](../config_mc/racer_setup.md)


<!--
- Explain what you have to tune on PX4, what you can tune, and what each topic covers
- I expect we should start with an exhaustive list of the tuning you could want to do - such as position tuning, etc. Do we have one?
 -->

<!-- TBD this is just text for me to mine

AFAIK autotune was tested on various not so custom platforms e.g. X500, racer quad, Loong standard VTOL. I honestly used it only once on a tricopter and it worked for roll and pitch but the resulting yaw tuning was not stable. Since then it was improved but that's not merged yet :eyes: https://github.com/PX4/PX4-Autopilot/pull/21857
Autotune was never tested on a Helicopter.
can you in theory autotune frame with any number of motors?
In theory yes but it needs to be able to have reasonable authority around all axes so I'd expect autotune to not work well for a monocopter without swashplate and so on. Probably also the controllers wouldn't work out of the box. I saw issues before with designs that tilt the rotor e.g. tricopter, bicopter, ... again


will PX4 still understand how to autotune?
Autotune should work for any vehicle that has reasonable authority and dynamics around all the body axes. A tiltable motor e.g. tricopter has at the least dynamics which are less tested with autotune.
My assumption is that the mixing system can cope with whatever geometry you throw at it.
Yes but it must be physically feasible. E.g. if you make a quadrotor where all motors turn the same way it will "deal" with it but that cannot work without very specific controllers. Same for a monocopter or a tricopter without swiveling one motor.
-->

## Дивіться також

- [QGroundControl > Налаштування](https://docs.qgroundcontrol.com/master/en/qgc-user-guide/setup_view/setup_view.html)
- [Периферія контролера польоту](../peripherals/index.md) - налаштування конкретних датчиків, опціональних датчиків, приводів тощо.
- [Розширена конфігурація](../advanced_config/index.md) - заводське калібрування/OEM, налаштування додаткових функцій, менш поширені конфігурації.
- Конфігурація/налаштування, що залежать від апарату:
  - **Конфігурація/налаштування мультикоптера**
  - [Конфігурація/налаштування гелікоптера](../config_heli/index.md)
  - [Конфігурація/налаштування літака (з нерухомим крилом)](../config_fw/index.md)
  - [Конфігурація/налаштування VTOL](../config_vtol/index.md)
