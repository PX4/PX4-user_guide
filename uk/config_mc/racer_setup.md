# Multicopter Racer Setup

This page describes how to setup and configure a multicopter racer for optimal performance (in particular for [Acro mode](../flight_modes_mc/acro.md)).

Пам'ятайте, що гонщики - це швидкі транспортні засоби, спеціально створені для того, щоб бути переважними! Вам вже слід мати деякий досвід, або дозвольте комусь з досвідом допомогти вам.

::: tip
Many things described here can also be applied to improve the flight performance of other types of multicopters.
:::

:::info
Звичайно гонщик пропускає деякі датчики (наприклад, GPS).
Як результат, менше надійних опцій доступно.
:::

## Опції збірки

Звичайно гонщик пропускає деякі датчики.

Мінімальна конфігурація полягає у використанні лише гіроскопа та акселерометра.

:::info
Якщо у платі є внутрішній магнітометр, його не слід використовувати (малі гонщики особливо схильні до сильних електромагнітних перешкод).
:::

Гонщики зазвичай не мають GPS, оскільки воно додає деяку вагу та може пошкодитися під час аварій (GPS + зовнішній магнітометр повинен бути розміщений на стійці GPS подалі від великих струмів, щоб уникнути магнітних перешкод, що, на жаль, означає, що його легко розбити).

Проте є деякі переваги у додаванні GPS, особливо для початківців:

- Ви можете перейти в режим утримання позиції, і транспортний засіб просто залишиться на місці. Це зручно, якщо ви втратили орієнтацію або потребуєте перерви. Це також може бути використано для безпечної посадки.
- Режим [Повернення](../flight_modes_mc/return.md) може бути використаний, або на перемикачі, або як аварійний режим втрати RC або низького заряду батареї.
- Ви матимете останню позицію, коли він вріжеся.
- Журнал містить трек польоту, що означає, що ви можете переглянути польот (у 3D). Це може допомогти вам покращити ваші акробатичні льотні навички.

:::info Під час агресивних акробатичних маневрів GPS може втратити позицію на короткий час. Якщо ви переключитеся в [режим позиції](../flight_modes_mc/position.md) під час цього часу, замість цього буде використовуватися [режим висоти](../flight_modes_mc/altitude.md), поки позиція знову не стане дійсною.
:::

## Налаштування обладнання

Наступні абзаци описують кілька важливих моментів під час будівництва транспортного засобу. Якщо вам потрібні повні інструкції зі збірки, ви можете дотримуватися журналу збірки [QAV-R 5" KISS ESC Racer](../frames_multicopter/qav_r_5_kiss_esc_racer.md).

### Налаштування вібрації

Існують різні підходи до кріплення для зменшення вібрацій. Наприклад, контролер польоту може бути встановлений з віброгасіючим піною або за допомогою [O-кілець](../frames_multicopter/qav_r_5_kiss_esc_racer.md#mounting).

Хоча немає одного кращого методу, у вас, як правило, буде менше проблем з вібраціями, якщо ви використовуєте високоякісні компоненти (раму, двигуни, пропелери), які, наприклад, використовуються у [QAV-R 5" KISS ESC Racer](../frames_multicopter/qav_r_5_kiss_esc_racer.md).

Не забудьте використати **збалансовані реквізити**.

### Центр гравітації

Переконайтеся, що центр ваги розташований як можливо ближче до центру тяги. Баланс ліворуч-праворуч зазвичай не є проблемою, але баланс вперед-назад може бути. Ви можете перемістити батарею до тих пір, поки вона не буде вірною і позначити її на рамі, щоб завжди правильно її розміщувати.

::: info
Інтегральний термін може враховувати незбалансоване налаштування, а спеціальний міксер може зробити це ще краще.
Проте краще виправити будь-який дисбаланс як частину налаштування автомобіля.
:::

## Налаштування програмного забезпечення

Після того, як ви побудуєте гонщика, вам потрібно буде налаштувати програмне забезпечення.

Пройдіть по [Керівництву з Основних Налаштувань](../config/index.md). Зокрема, встановіть [Airframe](../config/airframe.md), який найбільше відповідає вашому каркасу (зазвичай ви виберете каркас [Generic 250 Racer](../airframes/airframe_reference.md#copter_quadrotor_x_generic_250_racer), який за замовчуванням встановлює деякі параметри, специфічні для гонщика).

Ці параметри є важливими:

- Увімкніть режим One-Shot або DShot, вибравши протокол для групи виведення під час [налаштування приводу дії](../config/actuators.md).
- Встановіть максимальні швидкості крену, тангажу та курсу для режиму Manual/Stabilized за потребою: [MC_ROLLRATE_MAX](../advanced_config/parameter_reference.md#MC_ROLLRATE_MAX), [MC_PITCHRATE_MAX](../advanced_config/parameter_reference.md#MC_PITCHRATE_MAX) та [MC_YAWRATE_MAX](../advanced_config/parameter_reference.md#MC_YAWRATE_MAX). Максимальний кут нахилу налаштовується за допомогою [MPC_MAN_TILT_MAX](../advanced_config/parameter_reference.md#MPC_MAN_TILT_MAX).
- Мінімальний тяговий [MPC_MANTHR_MIN](../advanced_config/parameter_reference.md#MPC_MANTHR_MIN) повинен бути встановлений на 0.

### Оцінювач

Якщо ви використовуєте GPS, ви можете пропустити цей розділ і використовувати типовий оцінювач. В іншому випадку вам слід перейти на оцінювач відносин Q, який працює без магнітометра або барометра.

Щоб ввімкнути це, встановіть [ATT_EN = 1](../advanced_config/parameter_reference.md#ATT_EN), [EKF2_EN =0 ](../advanced_config/parameter_reference.md#EKF2_EN) та [LPE_EN = 0](../advanced_config/parameter_reference.md#LPE_EN) (для отримання додаткової інформації див. [Перемикання стану оцінювачів](../advanced/switching_state_estimators.md#how-to-enable-different-estimators)).

Потім змініть наступні параметри:

- Встановіть [SYS_HAS_MAG](../advanced_config/parameter_reference.md#SYS_HAS_MAG) на `0`, якщо у системі немає магнітометра.
- Встановіть [SYS_HAS_BARO](../advanced_config/parameter_reference.md#SYS_HAS_BARO) на `0`, якщо у системі немає барометра.
- Налаштуйте оцінювач Q: встановіть [ATT_ACC_COMP](../advanced_config/parameter_reference.md#ATT_ACC_COMP) на `0`, [ATT_W_ACC](../advanced_config/parameter_reference.md#ATT_W_ACC) на 0,4 та [ATT_W_GYRO_BIAS](../advanced_config/parameter_reference.md#ATT_W_GYRO_BIAS) на 0. Ви можете налаштувати це пізніше, якщо бажаєте.

### Безаварійність

Налаштуйте [втрату зв'язку та автоматичне вимкнення при низькому рівні заряду батареї](../config/safety.md). Якщо ви не використовуєте GPS, встановіть безпеку на випадок відмови на **Блокування**, яке вимикає двигуни. Тест втрати дистанційного керування на лавці без пристроїв, приєднаних шляхом вимкнення пульта дистанційного керування, коли транспортний засіб увімкнено.

Переконайтеся, що ви призначили [вимикач відключення](../config/safety.md#kill-switch) або [вимикач готовності](../config/safety.md#arm-disarm-switch). Протестируйте його і навчіться його використовувати!

### Налаштування PID

:::info
Переконайтеся, що ви калібруєте ESCs перед налаштуванням.
:::

На цьому етапі ви повинні бути готові до першого випробувального польоту.

Припускаючи, що транспортний засіб може літати за допомогою налаштувань за замовчуванням, ми спочатку робимо перший прохід по [Основній настройці ПІД для багатокоптерів (MC)](../config_mc/pid_tuning_guide_multicopter_basic.md). Транспортний засіб має бути **підтриманий** (**P** і **D** коефіцієнти повинні бути встановлені занадто низько), щоб не було осциляцій від контролера, які можна було б сприйняти як шум (типові коефіцієнти можуть бути достатні). Це важливо для [налаштування фільтра](#filter-tuning) (пізніше буде другий раунд налаштування PID).

### Затримка керування

_Затримка керування_ - це час від фізичного порушення транспортного засобу до реакції моторів на зміну.

:::tip
Це _важливо_ зменшити затримку управління настільки, наскільки це можливо! Зниження затримки дозволяє збільшити коефіцієнти **P** регулювання, що означає кращу польотну продуктивність. Навіть одна мілісекунда, додана до затримки, робить різницю.
:::

Це фактори, які впливають на затримку:

- М'яка конструкція або м'яка амортизація вібрацій збільшує затримку (вони діють як фільтр).
- [Фільтри низьких передач](../config_mc/filter_tuning.md) в програмному забезпеченні та на торгівлі датчиками збільшена затримка для покращення шумової фільтрації.
- Внутрішні складові програмного забезпечення PX4: сигнали датчиків потрібно зчитати у драйвері, а потім пройти через контролер до виходного драйвера.
- Мікросхема введення-виведення (головні контакти) додає приблизно 5,4 мс затримки порівняно з використанням додаткових контактів (це не стосується _Pixracer_ або _Omnibus F4_, але стосується Pixhawk). Щоб уникнути затримки введення-виведення, підключіть мотори до додаткових контактів замість головних.
- Сигнал виведення ШІМ: ввімкніть [Dshot](../peripherals/dshot.md) за бажанням, щоб зменшити затримку (або One-Shot, якщо DShot не підтримується). Протокол вибирається для групи виведень під час [налаштування приводу дії](../config/actuators.md).

### Налаштування фільтра

Фільтри вирішують проблему затримки управління та фільтрації шуму, обидва з яких впливають на продуктивність. Для отримання інформації див.: [Налаштування затримки фільтра/контролю](../config_mc/filter_tuning.md)

### Налаштування PID (другий раунд)

Зараз проведіть другий раунд налаштування PID, на цей раз якнайщільніше, а також налаштовуйте криву тяги.

:::tip
Ви можете використовувати підхід, описаний у [Основний налаштування PID для MC](../config_mc/pid_tuning_guide_multicopter_basic.md), щоб налаштувати раму, але вам доведеться використовувати [Розширений Підручник з Налаштування PID для Багатокоптерів (Розширений/Детальний)](../config_mc/pid_tuning_guide_multicopter.md#thrust-curve), щоб зрозуміти, як налаштувати криву тяги.

### Режим польоту

Після того, як ви перевірили, що транспортний засіб добре літає на низькому та високому режимах обертання, ви можете увімкнути [режим повітря](../config_mc/pid_tuning_guide_multicopter.md#airmode) за допомогою параметра [MC_AIRMODE](../advanced_config/parameter_reference.md#MC_AIRMODE). Ця функція гарантує, що автомобіль все ще контролюється і відслідковує швидкість з низькою частотою.

Щасливого перекидання :)
