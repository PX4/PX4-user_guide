# Режим Follow-Me Слідуй за мною (мультикоптер)

<img src="../../assets/site/position_fixed.svg" title="Position fix required (e.g. GPS)" width="30px" />

Режим _Follow Me_ дозволяє багтротору автономно утримувати позицію та висоту відносно іншої системи, яка транслює свою позицію (і, за бажанням, швидкість) за допомогою повідомлення MAVLink [FOLLOW_TARGET](https://mavlink.io/en/messages/common.html#FOLLOW_TARGET).

:::info

- Режим є автоматичним - для керування транспортним засобом не потрібне _втручання_ користувача.
- Режим потребує принаймні дійсної локальної оцінки позиції (не потребує глобальної позиції).
  - Літаючі апарати не можуть перемикатися в цей режим без валідної локальної позиції.
  - Літаючі транспортні засоби будуть аварійно переходити в безпечний режим, якщо втрачають оцінку позиції.
- Режим перешкоджає взброєнню (транспортний засіб повинен бути включеним при переході в цей режим).
- Режим вимагає, щоб швидкість вітру та час польоту були в межах допустимих значень (вказано через параметри).
- Цей режим в даний час підтримується лише на багатокоптерних (або VTOL у режимі MC).
- Також обраний об'єкт повинен мати можливість постачання інформації про позицію.
- Режим слідування підтримується _QGroundControl_ на пристроях Android з модулем GPS, та [MAVSDK](#follow-me-with-mavsdk).

<!-- https://github.com/PX4/PX4-Autopilot/blob/main/src/modules/commander/ModeUtil/mode_requirements.cpp -->

:::

## Загальний огляд

![Follow-me Concept](../../assets/flight_modes/followme_concept.png)

Транспортний засіб автоматично почне розвертатися, щоб вирівнятися з ціллю та слідувати за нею з вказаного [відносного кута](#FLW_TGT_FA), [відстані](#FLW_TGT_DST) та [висоти](#FLW_TGT_HT) та висоти, залежно від [режиму керування висотою](#FLW_TGT_ALT_M).

За замовчуванням він буде слідувати безпосередньо за цільовим об'єктом на відстані 8 метрів, і на висоті 8 метрів вище домашньої (озброєної) позиції.

Користувачі можуть налаштувати кут слідування, висоту та відстань за допомогою пульта дистанційного керування, як показано вище:

- _Керування Висотою_ здійснюється за допомогою введення `up-down` ("Ручка газу"). Центруйте палицю, щоб тримати відстеження цілі на постійній висоті. Підніміть або опустіть палицю, щоб налаштувати висоту.
- _Відстань слідування_ керується вхідним параметром `вперед-назад` ("Крен"). Тиснення палиці вперед збільшує відстань слідування, витягування назад зменшує відстань.
- _Слідкуйте за кутом_ керується за допомогою введення `left-right` ("Roll"). Рух відбувається з точки зору користувача, тому якщо ви стоїте обличчям до дрона й рухаєте палицю ліворуч, він буде рухатися ліворуч. Зверху, якщо ви рухатимете палицю вліво, квадрокоптер буде рухатися проти годинникової стрілки.

  Follow Angle визначається як збільшення в годинниковому напрямку відносно напрямку руху цілі (який дорівнює 0 градусів)

  ![Follow-me Angle Diagram](../../assets/flight_modes/followme_angle.png)

:::info
Кут, висота та відстань, встановлені за допомогою пульта керування RC, відкидаються, коли ви виходите з режиму слідування за мною. Якщо ви вийдете з режиму "Follow-Me" й активуєте його знову, значення будуть скинуті до їх типових значень.
:::

### Video

<lite-youtube videoid="csuMtU6seXI" params="start=155" title="PX4 Follow Target follows a Rover!"/>

### Safety Precautions

:::warning
**Follow-me mode** does not implement any type of obstacle avoidance. Special care must be taken when this mode is used.
:::

The following flight precautions should be observed:

- Режим слідування за мною слід використовувати тільки в широких відкритих місцях, які не перешкоджають дерева, електропроводи, будинки тощо.
  - Встановіть висоту [слідуй за висотою](#FLW_TGT_HT) на значення, яке вище будь-яких оточуючих перешкод. За _замовчуванням_ це є 8 метрів вище домашньої (озброювання) позиції.
- Це _безпечніше_ вручну піднятися на безпечну висоту перед активацією режиму 'слідуй за мною', ніж активувати режим 'слідуй за мною', коли приземлилися (навіть якщо режим реалізує автоматичний зліт).
- Надайте вашому транспортному засобу достатньо місця для зупинки, особливо коли він рухається швидко.
- Будьте готові повернутися до режиму позиціонування, якщо щось піде не так, особливо коли ви використовуєте режим слідування за мною вперше.
- Ви не можете вимкнути режим 'слідуй за мною', використовуючи рухи палицею RC (оскільки це налаштує властивості). Вам потрібно мати GroundStation, яка може відправляти сигнали перемикання режиму польоту або налаштований перемикач режиму польоту на вашому RC передавачі.

### Follow-Me with QGroundControl

![Follow-me QGC Example](../../assets/flight_modes/followme_qgc_example.jpg)

_Follow Me_ mode is supported using _QGroundControl_ as a target on ground station hardware that has a GPS module. The recommended configuration is a USB OTG-capable Android device with two telemetry radios.

To setup _Follow Me_ mode:

- Підключіть телеметричне радіо до пристрою земної станції та інше до транспортного засобу (це дозволяє передавати інформацію про позицію між двома радіостанціями).
- Вимкніть режим сну на вашому пристрої Android:
  - Цей параметр зазвичай можна знайти за адресою: **Налаштування > Відображення**.
  - Важливо, щоб ви встановили свій пристрій на Android, щоб не спав, оскільки це може призвести до того, що сигнал GPS перестане випромінюватися через регулярні інтервали.
- Зліт на висоту щонайменше 2-3 метри (рекомендується навіть якщо підтримується автоматичний зліт).
  - Поставте транспортний засіб на землю, натисніть безпечний перемикач і відійдіть принаймні на 10 метрів.
  - Збройте транспортний засіб і злітайте.
- Перемикайтеся в режим слідування за мною.
  - Коптер спочатку підніметься на мінімальну безпечну висоту 1 метр над землею або додому, залежно від наявності датчика відстані.
  - Він підніметься, поки не буде на висоті 3 метри в межах [висоти слідування](#FLW_TGT_HT), щоб уникнути можливих зіткнень перед рухом у горизонтальному напрямку.
  - Коптер завжди буде коригувати свою орієнтацію, щоб бути спрямованим на ціль

At this point you can start moving, and the drone will be following you.

The mode has been tested on the following Android devices:

- Galaxy S10
- Планшет Nexus 7

### Follow-me with MAVSDK

[MAVSDK](https://mavsdk.mavlink.io/develop/en/api_reference/classmavsdk_1_1_follow_me.html) supports [Follow Me](https://mavsdk.mavlink.io/main/en/cpp/guide/follow_me.html), allowing you to create a drone app that is a follow-me target.

For more information see the [Follow Me class](https://mavsdk.mavlink.io/main/en/cpp/guide/follow_me.html) documentation as well as the [Follow Me Example](https://mavsdk.mavlink.io/main/en/cpp/examples/follow_me.html).

::: info
MAVSDK is not currently recommended, due to a bug ([MAVSDK#1756](https://github.com/mavlink/MAVSDK/issues/1756) where the same message is occasionally sent twice. This can confuse the target position and velocity estimator.
:::

## Налаштування

### Altitude Control Mode

![Follow Me Altitude Modes](../../assets/flight_modes/followme_altitude_modes.svg)

The altitude control mode determine whether the vehicle altitude is relative to the home position, terrain height, or the altitude reported by the follow target.

- `2D відстеження` (режим [висоти за замовчуванням](#FLW_TGT_ALT_M)) дозволяє дрону слідувати на висоті відносно фіксованої домашньої позиції (висота зльоту). Відносна відстань до дрона до цілі зміниться, коли ви підніметесь та опуститесь (використовуйте обережно в гірській місцевості).

- `2D + Terrain` робить дрона слідувати на фіксованій висоті відносно місцевості під ним, використовуючи інформацію від датчика відстані.

  - Якщо у транспортному засобі немає датчика відстані, слідування буде ідентичним до `2D відстеження`.
  - Датчики відстані не завжди точні, і транспортні засоби можуть бути "скачущими" під час польоту в цьому режимі.
  - Зверніть увагу, що висота вимірюється відносно землі під транспортним засобом, а не цільового об'єкта. Дрон може не слідувати за змінами висоти цілі!

- Режим відстеження `3D tracking` дозволяє дрону слідувати на висоті відносно цілі відстеження, як постачається його GPS-датчиком. Це адаптується до змін висоти цілі, наприклад, коли ви йдете вгору по пагорбу.

:::warning
Do not set the **Altitude mode ([FLW_TGT_ALT_M](#FLW_TGT_ALT_M)**) to `3D Tracking` when using QGC for Android (or more generally, without checking that [FOLLOW_TARGET.altitude](https://mavlink.io/en/messages/common.html#FOLLOW_TARGET) is an AMSL value).

The MAVLink [FOLLOW_TARGET](https://mavlink.io/en/messages/common.html#FOLLOW_TARGET) message definition expects an altitude relative to mean sea level (AMSL) while QGC on Android is sending an altitude relative to the GPS ellipsoid. This can differ as much as 200 meters!

The drone probably won't crash due to the built-in minimum safety altitude limit (1 meter), but it may fly much higher than expected. If the drone's altitude is significantly different than specified, assume that the ground station's altitude output is wrong and use 2D tracking.
:::

### Parameters

The follow-me behavior can be configured using the following parameters:

| Параметр                                                                                                | Опис                                                                                                                                                                                                                                                                                                                                                                            |
| ------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <a id="FLW_TGT_HT"></a>[FLW_TGT_HT](../advanced_config/parameter_reference.md#FLW_TGT_HT)           | Висота автомобіля, який супроводжує, у метрах. Зверніть увагу, що ця висота фіксована _відносно дому/положення озброєння_ (а не цільового транспортного засобу). Стандартна та мінімальна висота - 8 метрів (близько 26 футів)                                                                                                                                                  |
| <a id="FLW_TGT_DST"></a>[FLW_TGT_DST](../advanced_config/parameter_reference.md#FLW_TGT_DST)         | Розділення транспортного засобу/станції на землі у _горизонтальній_ (x, y) площині, у метрах. Мінімально допустимий інтервал - 1 метр. Стандартна відстань - 8 метрів (близько 26 футів).                                                                                                                                                                                       |
| <a id="FLW_TGT_FA"></a>[FLW_TGT_FA](../advanced_config/parameter_reference.md#FLW_TGT_FA)           | Слідкуйте за кутом відносно напрямку руху цілі, в градусах. Якщо введено значення поза межами діапазону [`-180.0`, `+180.0`], воно буде автоматично звернуто і застосовано (наприклад, `480.0` буде конвертовано в `120.0`)                                                                                                                                                     |
| <a id="FLW_TGT_ALT_M"></a>[FLW_TGT_ALT_M](../advanced_config/parameter_reference.md#FLW_TGT_ALT_M)     | Режим керування висотою. <br>- `0` = 2D Відстеження (Висота фіксована) <br>- `1` = 2D Відстеження + Слідування за рельєфом <br>- `2` = 3D Відстеження висоти GPS цільової точки **УВАГА: [НЕ ВИКОРИСТОВУВАТИ З QGC для Android](#altitude-control-mode)**.                                                                                                    |
| <a id="FLW_TGT_MAX_VEL"></a>[FLW_TGT_MAX_VEL](../advanced_config/parameter_reference.md#FLW_TGT_MAX_VEL) | Максимальна відносна швидкість для орбітального руху навколо цілі, у м/с.<br>- 10 м/с виявився оптимальним показником для агресивності проти плавності.<br>- Встановлення більш високого значення означає, що траєкторія орбіти навколо цілі буде рухатися швидше, але якщо дрон фізично не здатний досягти такої швидкості, це призводить до агресивної поведінки. |
| <a id="FLW_TGT_RS"></a>[FLW_TGT_RS](../advanced_config/parameter_reference.md#FLW_TGT_RS)           | Динамічний алгоритм фільтрації, який реагує на фільтрацію вхідної цільової локації.<br>- `0.0` = Дуже чутливий до рухів та шумних оцінок позиції, швидкості та прискорення.<br>- `1.0` = Дуже стабільний, але не реагує на фільтр                                                                                                                                   |

### Tips and tricks

1. Встановіть відстань [слідування](#FLW_TGT_DST) більше 12 метрів (8 метрів є "рекомендованим мінімумом").

   Існує вроджений вплив позиції (3 ~ 5 метрів) між цільовим об'єктом та GPS-датчиком дрона, що змушує дрон слідувати 'примарній цілі' десь поблизу фактичної цілі. Це стає більш очевидним, коли відстань слідування дуже мала. Ми рекомендуємо встановити достатньо велику відстань, щоб відхилення GPS не було значним.

2. Швидкість, з якою ви можете змінювати кут слідування, залежить від параметра [максимальної тангенціальної швидкості](#FLW_TGT_MAX_VEL).

   Експеримент показує, що значення між `5 м/с` та `10 м/с` зазвичай є придатними.

3. Використовуючи коригування RC для висоти, відстані та кута, ви можете отримати деякі креативні знімки камери.

   <lite-youtube videoid="o3DhvCL_M1E" title="YUN0012 almostCinematic"/>


   This video demonstrates a Google-Earth view perspective, by adjusting the height to around 50 meters (high), distance to 1 meter (close). Що дозволяє перспективу, як знято з супутника.

## Відомі проблеми

- Телеметричне радіо SiK 915 МГц [відомо](../telemetry/sik_radio.md), що заважає сигналу GPS, який отримують деякі пристрої Android. Тримайте радіо та пристрій на базі Android якомога подалі один від одного при використанні режиму слідування цілі, щоб уникнути перешкод.
- QGC для Android повідомляє про неправильну висоту (висота над еліпсоїдом, а не над рівнем моря). Висота може бути відхиленою на до 200м!
