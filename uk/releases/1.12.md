# Реліз 1.12

- [Реліз 1.12](#release-1-12)
  - [Попередній реліз](#pre-releases)
  - [Зміни](#changes)
    - [Загальні](#common)
    - [Сенсори](#sensors)
    - [Апаратне забезпечення(Hardware)](#hardware)
    - [MAVLink](#mavlink)
    - [Командер](#commander)
    - [Мультикоптер](#multicopter)
    - [VTOL](#vtol)
    - [Управління](#control)
    - [GPS](#gps)
    - [NuttX](#nuttx)
    - [UAVCAN](#uavcan)

## Попередній випуск

- [Beta 4](https://github.com/PX4/PX4-Autopilot/releases/tag/v1.12.0-beta4)
- [Beta 3](https://github.com/PX4/PX4-Autopilot/releases/tag/v1.12.0-beta3)
- [Beta 2](https://github.com/PX4/PX4-Autopilot/releases/tag/v1.12.0-beta2)
- [Beta 1](https://github.com/PX4/PX4-Autopilot/releases/tag/v1.12.0-beta1)

## Зміни

### Загальні

- **RTL Тригер, що ґрунтується на залишковому польотному діапазоні ([PR#16399](https://github.com/PX4/PX4-Autopilot/pull/16399))**
  - Обчислює час до дому, у режимі RTL, враховуючи швидкість руху автомобіля, швидкість вітру та відстань/напрямок до пункту призначення
- **Заздалегідь порушення геозаборони ([PR#16400](https://github.com/PX4/PX4-Autopilot/pull/16400))**
  - Спрацьовує порушення, якщо _передбачається_, що поточна траєкторія призведе до порушення, дозволяючи перенаправити транспортний засіб до безпечного місця утримання.
- **Сценарії та конструкції повітряного корпусу**
  - Синтаксис для встановлення значень за замовчуванням було змінено, і власні сценарії потребують оновлення
  - Див. [PR#16796](https://github.com/PX4/PX4-Autopilot/pull/16796/files#diff-dcf2f5536f47f260e5e0ff3b3fd22eaef6b6c510126463d70affa0eb7bd4d3ddL20) для прикладу.
- Безпека (перемикач) за замовчуванням вимкнена (двигуни розброньовані, але сервоприводи / закрилки можуть рухатися)
- Безпековий перемикач є защіпним: коли він вимкнутий, він залишиться вимкнутим
- Засіб виявлення землі: Розширити виявлення землі для використання відстані до ґрунту, якщо датчик відстані присутній
- Додана підтримка для IRC Ghost включаючи телеметрію

### Сенсори

- Калібрування магнітомера швидше і надійніше
  - нові коефіцієнти калібрування для м'якого заліза
  - автоматично визначати обертання зовнішніх датчиків
- Оптимізований датчик керування швидкістю потоку даних (мінімальна затримка від кінця до кінця внутрішньої петлі)

### Апаратне забезпечення

Випуск включає новий апаратний засіб для наступних плат, периферійних пристроїв та аксесуарів:

- Pixhawk FMUv6U (Докладніше про цю специфікацію можна переглянути на [сховищі GitHub Pixhawk](https://github.com/pixhawk/Pixhawk-Standards))
- Pixhawk FMUv6X (Докладніше про ці специфікації можна прочитати на [сховищі Pixhawk GitHub](https://github.com/pixhawk/Pixhawk-Standards))
- CUAV X7 / X7Pro ([Дізнайтеся більше про цей продукт на сайті виробника](http://www.cuav.net/en/x7en/)]
- CUAV Нора ([Дізнайтеся більше про цей продукт на сайті виробника](http://www.cuav.net/en/nora/))
- CUAV CAN GPS ([Дізнайтеся більше про цей продукт на сайті виробника](http://www.cuav.net/en/neo-3-2/))
- SP Racing H7 Extreme ([Дізнайтеся більше про цей продукт на сайті виробника](http://seriouslypro.com/spracingh7extreme))
- Bitcraze Crazyflie v2.1 ([Дізнайтеся більше про цей продукт на сайті виробника](https://www.bitcraze.io/products/crazyflie-2-1/))
- ARK CAN Flow ([Дізнайтеся більше про цей продукт на сайті виробника](https://arkelectron.com/product/ark-flow/))
- mRo Ctrl Zero H7 (Експериментальний) ([Дізнайтеся більше про цей продукт на сайті виробника](https://store.mrobotics.io/mRo-Control-Zero-F7-p/mro-ctrl-zero-f7.htm))

Вони видалені:

- Вилучення з припиненням виробництва Intel AeroFC

### MAVLink

- **Конфігурація MAVLink Ethernet ([PR#14460](https://github.com/PX4/PX4-Autopilot/pull/14460))**
  - Налаштування каналу Ethernet MAVLink, такі як UDP-порт, віддалений порт та режим мовлення тепер можуть бути змінені динамічно за допомогою параметрів.
- **Підтримка запиту на отримання `COMPONENT_INFORMATION` ([PR#16039](https://github.com/PX4/PX4-Autopilot/pull/16039))**
  - Метадані параметра тепер автоматично синхронізуються в поєднанні з щоденним QGC.
  - Це нове повідомлення дозволяє будь-якій системі MAVLink запитувати різноманітну ієрархічну інформацію від автопілота, тобто розуміти, які команди підтримуються в місіях або отримувати метадані параметрів. Це повідомлення було введено в основному для того, щоб допомогти GCS краще розуміти автопілоти (RFC: [mavlink#1339](https://github.com/mavlink/mavlink/issues/1339))

### Головнокомандувач

- **Командер: використовуйте прапорці режиму керування та очищення озброєння/відбронювання ([PR#16266](https://github.com/PX4/PX4-Autopilot/pull/16266))**
  - Узгодьте розкидані вимоги щодо озброєння в arm_disarm(), та зберігайте останній стан `vehicle_control_mode` у командирі
- **Командер: Розділіть обробку установки керування вручну ([PR#16878](https://github.com/PX4/PX4-Autopilot/pull/16878))**
  - Додає новий клас `ManualControl` для обробки `manual_control_setpoint` та керує втратою RC, перевизначенням RC та активацією/дезактивацією RC

### Мультикоптер

- **Більш інтуїтивне відчуття палиці в режимі Position**

  - Горизонтальний вхід палиці відображений на точках прискорення замість встановлених точок швидкості
  - Видаляє неочікувані зміни нахилу при досягненні швидкості руху
  - Інтуїтивне переміщення, наприклад, при посадці
  - Opt out possible using [MPC_POS_MODE](../advanced_config/parameter_reference.md#MPC_POS_MODE)
  - Розробка: [Перший спроба](https://github.com/PX4/PX4-Autopilot/pull/12072), [Вступ](https://github.com/PX4/PX4-Autopilot/pull/16052), [Покращення](https://github.com/PX4/PX4-Autopilot/pull/16320), [Виправлення помилки нульових коливань](https://github.com/PX4/PX4-Autopilot/pull/16786), [Виправлення помилки розблокування позиції](https://github.com/PX4/PX4-Autopilot/pull/16791), [Виправлення невірно заданої точки](https://github.com/PX4/PX4-Autopilot/pull/17078), [Виправлення високої швидкості перед зльотом](https://github.com/PX4/PX4-Autopilot/pull/17437)

- **Виграш штовхання незалежних коефіцієнтів керування швидкістю**

  - Параметри `MPC_{XY/Z}_VEL_{P/I/D}` були замінені на `MPC_{XY/Z}_VEL_{P/I/D}_ACC`, див.: [MPC_XY_VEL_P_ACC](../advanced_config/parameter_reference.md#MPC_XY_VEL_P_ACC), [MPC_XY_VEL_I_ACC](../advanced_config/parameter_reference.md#MPC_XY_VEL_I_ACC), [MPC_XY_VEL_D_ACC](../advanced_config/parameter_reference.md#MPC_XY_VEL_D_ACC), [MPC_Z_VEL_P_ACC](../advanced_config/parameter_reference.md#MPC_Z_VEL_P_ACC), [MPC_Z_VEL_I_ACC](../advanced_config/parameter_reference.md#MPC_Z_VEL_I_ACC), [MPC_Z_VEL_D_ACC](../advanced_config/parameter_reference.md#MPC_Z_VEL_D_ACC)

:::warning
Прибутки отримали нове значення

    - Шкала відхилення від швидкості у $м/с$ до виходу прискорення у $м/с^2$
    - Існуючі виграші потрібно приблизно перескалювати множником: $гравітаційна \_ стала / тяга \_ струму$
    - Автоматичний перехід параметра передбачає 50% тяги під час нависання: `~10м/с² / 50% = 20 м/с²`. Дивіться [питання](https://github.com/PX4/PX4-Autopilot/pull/14823#issuecomment-791357646)
:::

  - Розробка: [Введення логіки](https://github.com/PX4/PX4-Autopilot/pull/14749), [Заміна параметра](https://github.com/PX4/PX4-Autopilot/pull/14823)

- **Покращити круглі повороти ([PR#16376](https://github.com/PX4/PX4-Autopilot/pull/16376))**
  - Створює більш округлений поворот при точках маршруту в місіях мультиротора (використовуючи логіку навігації у стилі L1 на кутах)
  - Дивіться [Режим Місії > Міжточкова Траєкторія](../flight_modes_fw/mission.md#rounded-turns-inter-waypoint-trajectory) та [Місія > Встановлення Прийняття/Радіус Обертання](../flying/missions.md#setting-acceptance-turning-radius)
- **Видалення режиму польоту Rattitude ([PR#17019](https://github.com/PX4/PX4-Autopilot/pull/17019))**
  - Сповістіть нас, якщо ви хочете повернути його.

### VTOL

- **Покращення RTL ([PR#16377](https://github.com/PX4/PX4-Autopilot/pull/16377))**
  - Підвищує надійність RTL безпекових заходів, враховуючи багато крайніх випадків при спробі посадки, залежно від поточного режиму транспортного засобу (Багатокоптерний проти Фіксований крило)
- Значні вдосконалення ТЕКС фіксованого крила / VTOL

### Управління

- **Динамічний фільтр пазуру оновлено за допомогою Гіроскопічного FFT ([PR#16385](https://github.com/PX4/PX4-Autopilot/pull/16385))**
  - Додає динамічне фільтрування виѐмок до даних керування гіроскопом, що призводить до набагато плавнішого керування
- **Багатоступеневий EKF активовано за замовчуванням** на платах stm32f7 та stm32h7

### GPS

- GPS-протокол тепер за замовчуванням має бути змінений u-blox для швидкого запуску, а [GPS_x_PROTOCOL](../advanced_config/parameter_reference.md#GPS_1_PROTOCOL) під час використання іншого GPS.

### NuttX

Nuttx було оновлено з [8.2+ до NuttX 10.10.0+](https://github.com/apache/incubator-nuttx/compare/nuttx-8.2..nuttx-10.0.1) (@ [904a602c74dc08a100b5c2bd490807de19e73e10](https://github.com/apache/incubator-nuttx/commit/904a602c74dc08a100b5c2bd490807de19e73e10))

- **Продуктивність SDCARD:** Результат у покращенні продуктивності на цілях H7
  - [**BACKPORT**] stm32:SDIO:Використовуйте тайм-аут шляху даних 250 мс, незалежно від частоти картки
  - [** BACKPORT **] stm32h7:SDMMC:Використовуйте таймаут шляху даних 250 мс, незалежно від частоти картки
  - [**БЕКПОРТ**] stm32f7:SDMMC:Використовуйте таймаут шляху даних 250 мс, незалежно від частоти картки
  - [**BACKPORT**] Виправлення гонки при умовах очікування в логіці драйвера SDMMC.
  - [**BACKPORT**] mmcsd:Застряг в 1-бітному режимі, Видалено CONFIG_ARCH_HAVE_SDIO_DELAYED_INVLDT
- **Стабільність Ethernet:**
  - [**Назадпорт**] stm32x7:Ethernet Виправлені hardfaults, занадто великі фрейми
  - [**ВІДШИВАННЯ**] stm32:Ethernet Fix too big frames
- **Стабільність завантаження** V5-V6X забезпечує запуск годинника LSE (RTC)

  - [**BACKPORT**] stm32h7:lse виправлення тексту довідки Kconfig
  - [** BACKPORT **] stm32f7:lse Використання значень Kconfig безпосередньо
  - [** BACKPORT **] stm32h7:Додавання DBGMCU
  - [** BACKPORT **] stm32f7: Додати опцію автоматичного вибору LSE ЗДАТНІСТЬ
  - [**BACKPORT**] stm32h7:Додано опцію автоматичного вибору LSE CAPABILITY

    :::info
Ця Ручка переключиться через вірні*
значення від низького до високого. Щоб уникнути пошкодження
кристалу. Ми хочемо використовувати найнижче значення
, що запускає OSC. Див. додаток AN2867
*Функція враховуватиме версію кремнію
і використовуватиме правильні кодові точки для досягнення впливу
приводу. Див. Eratta ES0392 Rev 7 2.2.14 Вибір бітів для вибору можливості приводу LSE осцилятора обмінюється.
:::

- **Зміни водія**

  - [** BACKPORT **] драйвери/серійний порт: виправлення увімкнення переривань Rx для cdcacm
  - [** BACKPORT **] binnfmt:Виправлення повернення перед закриттям файлового дескриптора ELF

  - [**BACKPORT**] stm32f7:Дозволити повторне використання GPIO OTG_ID
  - [**BACKPORT**] stm32f7:SDMMC виправлення скидання do_gpio
  - [**BACKPORT**] stm32h7: serial: використання dma tx semaphore як resource holder
  - [**BACKPORT**] stm32h7:SDMMC виправлення скидання do_gpio
  - [**BACKPORT**] stm32h7: Serial Додавання RX та TX DMA
  - [**BACKPORT**] stm32h7:Дозволити повторне використання GPIO OTG_ID

  - [**BACKPORT**] Kinetis:kinetis:Заміна DMA
  - [**BACKPORT**] kinetis:Serial використання eDMA
  - [**BACKPORT**] kinetis:SPI використання eDMA
  - [**BACKPORT**] Kinetis:Serail Не потрібен DMA Poll

  - [**BACKPORT**] libc/stdio: Преалокація stdin, stdout та stderr для систем без консолей.

- **Виправлення FlexCan**
  - [**BACKPORT**][flexcan] Виправлення стану скидання для CTRL1 register
  - [**BACKPORT**][flexcan] Виправлення TX drop #2792 та правильне налаштування таймінгу CAN на ненульові реєстри
  - [**BACKPORT**] FlexCAN Виправлення відміни процесу TX
- **Підтримка завантажувача CAN**
  - [**BACKPORT**] s32k1xx:Підтримка ramfunc
- **Очищення STM32F412**
- [**BACKPORT**] stm32f412: Виправлено підрахунок пінів
- [**BACKPORT**] stm32f412: Замінено невдалу карту пінів на карту для SoC
- [**BACKPORT**] stm32412: Виправлення карти пінів CAN1
- **Оновлення безпеки**
- [**BACKPORT**] tcp: Видалити неповну підтримку перезбірки TCP
- [**BACKPORT**] net/tcp/tcp_input.c: Виправлення неправильної перевірки довжини спеціальних даних
- [**BACKPORT**] libc: Додати додаткові перевірки до malloc realloc та memalign
- **Виправлення IMXRT**
- Додавання Single wire та правильних налаштувань парності до IMXRT для підтримки sbus та іншого.
- [**BACKPORT**] imxrt:serial підтримка режиму single-wire
- [**BACKPORT**] imxrt:imxrt_lowputc Fixed parity settings.
- **STM32H7 improvements**
- [**BACKPORT**] stm32h7:SPI Fix 16 bit SPI mode
- [**BACKPORT**] stm32h7:DMA BDMA does not auto disabled on completion
- [**BACKPORT**] Fix HEAP clobbering static data in SRAM4
- [**BACKPORT**] stm32h7:SDMMC fix reset of do_gpio

### UAVCAN

- UAVCANv0: Хоча базові функції, такі як оновлення прошивки та синхронізація параметрів вузлів CAN, були впроваджені більше 5 років тому, ми оновили підтримку, тепер, нарешті, пристрої є на ринку. Типові модулі CAN GPS, швидкості повітря та потужності підтримуються
- UAVCANv0 Вузол: PX4 підтримував будівництво вузлів протягом багатьох років - тепер ми підтримуємо будівництво конкретних цілей, таких як одиниці GPS CUAV
- UAVCANv1: Початковий альфа-варіант повної реалізації від кінця до кінця
